<!DOCTYPE html>
<html lang="en">
<head>
    <title>StickShift Timeline</title>
    <script type="text/javascript" src="http://underscorejs.org/underscore.js"></script>
    <script type="text/javascript" src="http://backbonejs.org/backbone.js"></script>
    
    
        <link type="text/css"
                rel="stylesheet"
                href="./css/stickshift.css"/>
                
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
  <script>
    var ss$ = jQuery.noConflict();
    var $ = ss$;
  </script>
  <script type="text/javascript" src="http://usestickshift.com/jquery.qrcode.min.js"></script>
    <script type="text/javascript" src="http://ricostacruz.com/jquery.transit/jquery.transit.min.js"></script>


    
  <script type="text/javascript" src="https://cdn.firebase.com/v0/firebase.js"> </script>
  <script type='text/javascript' src='https://cdn.firebase.com/js/simple-login/1.3.0/firebase-simple-login.js'></script>
  <script src="https://cdn.firebase.com/libs/backfire/0.3.0/backbone-firebase.min.js"></script>

    <meta charset="utf-8">
    <meta name="description" content="StickShift Timeline">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <!--<link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">-->
    
    
    
    <script type="text/javascript" src="./js/stickshift.js"></script>
    <script type="text/javascript" src="./js/timeline.js"></script>


    <!-- Style-->
    <style>
      html, body {
       height:100%;
       padding: 0px;
       margin: 0px;
      }
    </style>
    <!-- HTML5 shim, for IE6-8 support of HTML elements--><!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  </head>
  <body>
      

    

      <!-- BEGIN Timeline Embed -->
       
      <div id="timeline-embed"></div>
           <div id='blank'></div>
    <div id='qr'></div>
      
      <script type="text/javascript">
        var timeline_config = {
         width: "100%",
         height: "100%",
         source: {
          timeline: {
            headline: 'Iowa Startup Timeline',
            type: 'default',
            text: 'A Chronology of Notable Events in the Iowa Startup Scene',
            date: []
          }
         },
         type: 'timeline',
         embed_id: 'timeline-embed',
         debug: true,
        }
      </script>
      
      <script type="text/javascript">
      var appID= '-JKknZDQqkG1foOpBIMx',
        sShiftView = ssft('blank').stickShiftView(appID);
        ss$(sShiftView.e).on("dataUpdate", function(evt, extraArgs){
        
          if(extraArgs.val){
            console.log('Action: '+extraArgs.val.action+' url: '+extraArgs.val.url);
            switch (extraArgs.val.action)
            {
            case "nextItem":
              console.log("Next Item");
              ss$(".nav-next").trigger('click');
            break;
            case "previousItem":
              console.log("Next Item");
              ss$(".nav-prev").trigger('click');
            break;
            case "zoomIn":
              console.log("Next Item");
              ss$(".zoom-in").trigger('click');
            break;
            case "zoomOut":
              console.log("Next Item");
              ss$(".zoom-out").trigger('click');
            break;

            default:
            console.log("default action item triggered");
            break;
            }
          }
      });
      
    </script>
      <script type="text/javascript" src="./js/storyjs-embed.js"></script>
      <script type="text/javascript">
        function updateTimeline(){
          $('#timeline-embed').replaceWith('<div id="timeline-embed"></div>')
          createStoryJS(function(){}, timeline_config);
        }
        //var timelineDeferred = new ss$.Deferred();
        var dataFb = new Firebase('https://sstimeline.firebaseio.com/test');
        dataFb.on('value', function(snapshot){
          var snapData = snapshot.val();
          timeline_config.source = snapData;
          updateTimeline();
        });

        var sourceFb = new Firebase('https://sstimeline.firebaseio.com/entry');
        var destFb = new Firebase('https://sstimeline.firebaseio.com/test/timeline/date');
        sourceFb.on('value', function(snapshot){
          var snapData = snapshot.val();
          _.each(snapData, function(entry, idx){
            var event = {};
            var saneData = {
              location: entry.wheredidthiseventtakeplace.value,
              category: entry.whattypeofentitywaseffectedbythisevent.value,
              entity: entry.whatentity.value,
              description: entry.describetheevent.value,
              date: new Date(entry.whatdatedidtheeventoccur.value)
            };
            event.startDate = saneData.date.getFullYear() + ',' + saneData.date.getMonth() + ',' + saneData.date.getDay();
            event.endDate = event.startDate;
            event.headline = saneData.entity;
            event.text = saneData.description;
            destFb.child(idx).set(event);
          });
        });
        
        $(document).ready(function(){
          updateTimeline();
        });
      </script>
      <!-- END Timeline Embed-->
  </body>
</html>